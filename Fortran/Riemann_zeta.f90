	function Riemann_zeta(s) result(f)
! Riemann_zeta computes the Riemann zeta function in the entire complex plane
!
!    f = Riemann_zeta(s) computes zeta(s) for complex input s
!    The input s must be a scalar (this code is not vectorized)
!
! -------------------------------------------------------------------------
! Author: Alexey Kuznetsov
! York University, Toronto, Canada
! Website: https://kuznetsovmath.ca/
! Email: akuznets@yorku.ca
!
! Created: 28-Nov-2025
! Last updated: 5-Dec-2025
!
! License: BSD 3-Clause (https://opensource.org/licenses/BSD-3-Clause)
!--------------------------------------------------------------------------	
	implicit none
	complex (kind=16), intent(in)	:: s	
	complex (kind=16)		:: f	
	real(kind=16), parameter	:: pi_16=3.141592653589793238462643383279502884q0
	complex(kind=16), parameter	:: i_16=(0.0q0,1.0q0) 
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	if (s%re>=0.5q0) then
		f=Riemann_zeta_half_plane(s)
	else ! use reflection formula for the Riemann zeta function for Re(s)<0.5
		if (s%im>=0) then
			f=i_16*(2*pi_16)**(s-1)*(1-exp(i_16*pi_16*s))*exp(-0.5q0*i_16*pi_16*s&
				+ln_gamma(1-s))*Riemann_zeta_half_plane(1-s)
		else
			f=-i_16*(2*pi_16)**(s-1)*(1-exp(-i_16*pi_16*s))*exp(0.5q0*i_16*pi_16*s&
				+ln_gamma(1-s))*Riemann_zeta_half_plane(1-s)
		end if
	end if	
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	
	end function Riemann_zeta
!#######################################################################
	function Riemann_zeta_half_plane(s) result(f)
! computes zeta(s) in the half-plane Re(s)>=0.5
	implicit none
	complex (kind=16), intent(in)	:: s	
	complex (kind=16)		:: f
	real(kind=16)			:: N_sum, N_EM, N_12
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	
	N_sum=8*exp(75/(s%re-1))/30  ! computational complexity of zeta_summation function -- counting the number of evaluations of k^{-s}
	N_EM=abs(s)/2+20		    ! computational complexity of zeta_Euler_Maclaurin function			
	N_12=sqrt(abs(s%im)/(2*pi_16))/2+122	! computational complexity of zeta_12 function
	if (abs(s%im)<200) then 
		if (s%re<4) then
			f=zeta_Euler_Maclaurin(s)
		else	
			if (N_sum<N_EM) then
				f=zeta_summation(s)
			else
				f=zeta_Euler_Maclaurin(s)
			end if
		end if
	elseif (s%im>=200) then 
		if (s%re<4) then
			f=zeta_30(s)
		else	
			if (N_sum<N_12) then
				f=zeta_summation(s)
			else
				f=zeta_30(s)
			end if
		end if
			
	else
		if (s%re<4) then
			f=conjg(zeta_30(conjg(s)))
		else	
			if (N_sum<N_12) then
				f=zeta_summation(s)
			else
				f=conjg(zeta_30(conjg(s)))
			end if
		end if
				
	end if
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	
	end function Riemann_zeta_half_plane
!#######################################################################	
	function zeta_summation(s) result(f)
! approximates the Riemann zeta function f=zeta(s)=\sum_{n=1}^{\infty} n^{-s} 	
! to have more efficient computation, we instead compute g(s)=((1-2^{-s})(1-3^{-s})(1-5^{-s})) zeta(s) 
! which is the Dirichlet series g(z)=\sum_{n>=1, gcd(n,30)=1} n^{-s} 
! this trick removes about three-quarters of the terms from the original sum \sum_{n=1}^{\infty} n^{-s}
! we truncate the Dirichlet series for g(z) at n=N*30
! for Re(s)>2 the error is smaller than (30*N)^(1-Re(s))
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	
	implicit none
	complex (kind=16), intent(in)	:: s
	complex (kind=16)		:: f
	integer, parameter 		:: k(1:8)=(/1, 7, 11, 13, 17, 19, 23, 29/) ! residue classes mod 30 that are co-prime to 30
	integer				:: N, j, l
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	N=floor(exp(75/(s%re-1))/30)  ! choose N so that the error is smaller than 10^{-31}
	f=0
	do j=1,8
		do l=0,N
			f=f+(k(j)+30*l)**(-s)
		end do
	end do
	f=f/((1-2**(-s))*(1-3**(-s))*(1-5**(-s)))
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	end function zeta_summation
!#######################################################################
function RS_main_sum(s,N) result(f)
! computes the two main sums in the Riemann-Siegel formula: f(1)=\sum_{n=1}^{N} n^{-s} and f(2)=\sum_{n=1}^{N} n^{s-1}
! we remove almost 50% of terms from these sums by using the following result:
! denote F(x)=\sum_{1<=n<=x} n^{-s} and G(x)=\sum_{1<=2n+1<=x} (2n+1)^{-s}
! then F(x)=G(x)+2^{-s} G(x/2)+4^{-s} G(x/4)+8^{-s} G(x/8)+16^{-s} F(x/16)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~		
	complex (kind=16), intent(in)	:: s
	integer, intent(in)		:: N
	complex (kind=16)		:: f(1:2), g2(1:2), g4(1:2), g8(1:2), u
	integer				:: k
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	
	if (N<16) then
		f=1
		do k=2,N
			u=k**(-s)
			f(1)=f(1)+u
			f(2)=f(2)+1/(u*k)
		end do
	else
		f=1
		do k=2,(N/16)
			u=k**(-s)
			f(1)=f(1)+u
			f(2)=f(2)+1/(u*k)
		end do
		g8=1
		do k=1,((N/8)-1)/2
			u=(2*k+1)**(-s)
			g8(1)=g8(1)+u
			g8(2)=g8(2)+1/(u*(2*k+1))
		end do		
		g4=g8
		do k=((N/8)+1)/2,((N/4)-1)/2
			u=(2*k+1)**(-s)
			g4(1)=g4(1)+u
			g4(2)=g4(2)+1/(u*(2*k+1))
		end do
		g2=g4
		do k=((N/4)+1)/2,((N/2)-1)/2
			u=(2*k+1)**(-s)
			g2(1)=g2(1)+u
			g2(2)=g2(2)+1/(u*(2*k+1))
		end do
		u=2**(-s)
		f(1)=u**4*f(1)+u**3*g8(1)+u**2*g4(1)+(u+1)*g2(1)
		u=1/(u*2)
		f(2)=u**4*f(2)+u**3*g8(2)+u**2*g4(2)+(u+1)*g2(2)
		do k=((N/2)+1)/2,(N-1)/2
			u=(2*k+1)**(-s)
			f(1)=f(1)+u
			f(2)=f(2)+1/(u*(2*k+1))
		end do
	end if
	end function RS_main_sum		
!#######################################################################
	function zeta_Euler_Maclaurin(s) result(f)
	implicit none
	complex (kind=16), intent(in)	:: s
	complex (kind=16)		:: f, m
	integer				:: k, N, N2
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
! computes zeta(s) via Euler-Maclaurin summation 
! we use formula (25.2.10) at https://dlmf.nist.gov/25.2 with n=25
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
! precompute b(k)=B_{2k}/(2k)!, where B_{k} are Bernoulli numbers
   real(kind=16), parameter	:: b(1:25)=&	
   (/8.33333333333333333333333333333333293q-2,&
    -1.38888888888888888888888888888888893q-3,&
    3.30687830687830687830687830687830844q-5,&
    -8.26719576719576719576719576719577148q-7,&
    2.08767569878680989792100903212014440q-8,&
    -5.28419013868749318484768220217955963q-10,&
    1.33825365306846788328269809751291339q-11,&
    -3.38968029632258286683019539124944525q-13,&
    8.58606205627784456413590545042563573q-15,&
    -2.17486869855806187304151642386592068q-16,&
    5.50900282836022951520265260890226040q-18,&
    -1.39544646858125233407076862640635689q-19,&
    3.53470703962946747169322997780380424q-21,&
    -8.95351742703754685040261131811275565q-23,&
    2.26795245233768306031095073886817000q-24,&
    -5.74479066887220244526388198760702843q-26,&
    1.45517247561486490186626486727133221q-27,&
    -3.68599494066531017818178247990866798q-29,&
    9.33673425709504467203255515278564467q-31,&
    -2.36502241570062993455963519636984353q-32,&
    5.99067176248213430465991239681967181q-34,&
    -1.51745488446829026171081313586472285q-35,&
    3.84375812545418823222944529099024291q-37,&
    -9.73635307264669103526762127925048019q-39,&
    2.46624704420068095710640028028884984q-40/)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
	N=floor(abs(s)/2)+20
	N2=N**2
	m=s/N
	f=0
	do k=1,25
		f=f+b(k)*m
		m=m*(s+2*k-1)*(s+2*k)/N2
	end do
	f=1+N**(-s)*(f+0.5q0+N/(s-1))
	do k=2,(N-1)
		f=f+k**(-s)
	end do
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  
	end function zeta_Euler_Maclaurin
!#######################################################################
	function zeta_30(s) result(f)
! computes the approximation zeta_{30}(s) to the Riemann zeta function described in 
! [1] A. Kuznetsov, "Simple and accurate approximations to the Riemann zeta function", 2025,  https://arxiv.org/abs/2503.09519	
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  	
	implicit none
	complex (kind=16), intent(in)	:: s
	complex (kind=16)		:: f, s1, chi, I1, I2, g(1:2)
	real (kind=16)			:: M, u
	integer				:: k, j, N
	real(kind=16), parameter	:: pi_16=3.141592653589793238462643383279502884q0
	complex(kind=16), parameter	:: i_16=(0.0q0,1.0q0) 	
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   complex(kind=16), parameter	:: lambda(1:30)=&	
   (/(8.13966199675034970660458615530598713q-2,-6.81344065892866774297280205203749153q-2),&
     (1.62259023040472653411697689586238411q-1,-1.36591599910140350139521912975227263q-1),&
     (2.42279174241626082847426719848600355q-1,-2.05854323125991012636482192257254617q-1),&
     (3.21583211474595305011783162665304861q-1,-2.76460979356353061013811202191655399q-1),&
     (4.00663297528166464600216265380322250q-1,-3.48687630178895285447029146343591853q-1),&
     (4.80024358549341207264144102353239377q-1,-4.22436475676135107999276616214571223q-1),&
     (5.59950776730116654810869776988168555q-1,-4.97438575702765458667728686387217147q-1),&
     (6.40534277337219370302631404568561111q-1,-5.73462254904969570719782971411347677q-1),&
     (7.21783312286715651884518535097617073q-1,-6.50379504302963964489583441295469713q-1),&
     (8.03695943867215414246703445780656497q-1,-7.28151122613955077580508546513583302q-1),&
     (8.86289850248826353092894582316817865q-1,-8.06796024423231676183360649172513049q-1),&
     (9.69609631022672474014476154988176740q-1,-8.86367449880216437166051501291424696q-1),&
     (1.05372525342395614534685352667415322q0,-9.66938830484664130611866497126336160q-1),&
     (1.13872832880960948465454734686256448q0,-1.04859727805802505471351594995600894q0),&
     (1.22472921184312909987208986597337859q0,-1.13144230261512092220852103445684798q0),&
     (1.31185614296709457710532485455440130q0,-1.21558784015141903567716411991973944q0),&
     (1.40025676670460002500064191686431487q0,-1.30116630577303055785089686392191452q0),&
     (1.49010200440868910166446115249888771q0,-1.38833406868793528045108271727809758q0),&
     (1.58159230615714119326336583314005249q0,-1.47727839707733393239456181121365116q0),&
     (1.67496665378199292409087258913830363q0,-1.56822651913715750678555720630126400q0),&
     (1.77051529348829686470855876798894983q0,-1.66145807392854386370016159065678307q0),&
     (1.86859812936148731249703961472235019q0,-1.75732309201234970524508927357629332q0),&
     (1.96967232723933760092332263687146630q0,-1.85626915263791492244882812294199153q0),&
     (2.07433574942330377447335366024560143q0,-1.95888433469210368480532849743121304q0),&
     (2.18339930078478752574151857907289180q0,-2.06596894525760190345347729057106589q0),&
     (2.29801633666506561153152885735237624q0,-2.17866394844353675887129545200030286q0),&
     (2.41993708166486656967395128264451218q0,-2.29870351286710116888374805504176910q0),&
     (2.55208035686666663485113881125109739q0,-2.42898249322690787062995402539747305q0),&
     (2.70011496250973235698991415490513097q0,-2.57512580014291629199368964391591763q0),&
     (2.87889975443291670030907170644259612q0,-2.75187810860983902201629760468449616q0)/)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   complex(kind=16), parameter	:: omega0=(1.05769496572820966730990423486314379q-1,9.47827426333283458327782012884518084q-3)
   complex(kind=16), parameter	:: omega(1:30)=&
   (/(1.00422215655253716574167597886074586q-1,1.36138070008954932852628096531200796q-2),&
     (8.43305682343956518238524842887694903q-2,2.29610024883924154883188381603019215q-2),&
     (5.98392183290324210524682400653638206q-2,3.00230764456058599188284676573910191q-2),&
     (3.43494369834482454121719131569853234q-2,2.90446698182989561378710853928865495q-2),&
     (1.56010390524907670247820180166350064q-2,2.15660447430219441016266082204606108q-2),&
     (5.45448597412760185035043229229828663q-3,1.30020588741796607805145556526845939q-2),&
     (1.25681099858987180238679319303190399q-3,6.67916303239047033658766971215701925q-3),&
     (-3.38027434631632990996786312403443403q-5,3.00881801513464628845077643382633903q-3),&
     (-2.43775761315527210710100761455718177q-4,1.20250369847109540388838098570340006q-3),&
     (-1.72725669762904241732126924219198332q-4,4.26527263349754447500945821132467170q-4),&
     (-8.51549876418993735959547835160528741q-5,1.33344537104727284623922779232264251q-4),&
     (-3.39296792393312924907275534828320185q-5,3.62617325904857887953073458995567508q-5),&
     (-1.14151213237442618622250588645028667q-5,8.38843482432938139963421493604290881q-6),&
     (-3.29495700850678031469037695903262584q-6,1.58170164806126041995671040848379795q-6),&
     (-8.20076062622124839495804035652123021q-7,2.18057749003626741479247873932460448q-7),&
     (-1.75835279884878734830679708263109282q-7,1.24273999470638723436819929480785413q-8),&
     (-3.23120465670168241429035920242925385q-8,-3.91911796765893209053367408549792468q-9),&
     (-5.04196552186666667621467479726892587q-9,-1.63881635830168673176456291618968478q-9),&
     (-6.58565581404601846682999082185901104q-10,-3.68898788901734226008701102864339606q-10),&
     (-7.04535754749504095939408999151764980q-11,-6.05942390033951713783321994944663501q-11),&
     (-5.95901918962439762720601219895321110q-12,-7.72994631314693373932917956234436540q-12),&
     (-3.72722622932890981081457400106667569q-13,-7.75336352164026710292682865627438454q-13),&
     (-1.44208866854798652919513404593555745q-14,-6.06217055364787165513360752524083559q-14),&
     (-4.22711528049565223910815654507569745q-17,-3.60963428689030578137607994541246389q-15),&
     (3.50622116440313996278550898153119806q-17,-1.57401621130138394145650019010317644q-16),&
     (2.35076894840894691584485745245626498q-18,-4.72522651354144554829517532658097745q-18),&
     (7.72629724603682009718240804753192158q-20,-8.81862695845698940210251286622907069q-20),&
     (1.31285353163066348003097517071102679q-21,-8.44891175933088274204592500917066212q-22),&
     (9.53497219882960807744080516732388781q-24,-2.52117538150527074072091207119120939q-24),&
     (1.64043553556278151277302777581272001q-26,1.98609190761261802023682878534566556q-27)/)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~	
	! compute chi(s)=(2*pi)^s/(2*cos(pi*s/2)*gamma(s))
	chi=exp(s*log(2*pi_16)+0.5q0*pi_16*i_16*s-log(1+exp(pi_16*i_16*s))-ln_gamma(s))
	!compute the main sum
	N=floor(sqrt(s%im/(2.0q0*pi_16)))
	g=RS_main_sum(s,N)  ! compute the main sums in the Riemann-Siegel formula
	!compute I1=I_{M,30}(s) and  I2=conjg(I_{M,30}(1-conjg(s)))
	M=N+0.5q0	
	I1=exp(-s*log(M))*(omega0+sum(omega*(exp(-2*pi_16*M*lambda-s*log(1+i_16*lambda/M))&
		+exp(2*pi_16*M*lambda-s*log(1-i_16*lambda/M)))))
	s1=1-conjg(s)	
	I2=conjg(exp(-s1*log(M))*(omega0+sum(omega*(exp(-2*pi_16*M*lambda-s1*log(1+i_16*lambda/M))&
		+exp(2*pi_16*M*lambda-s1*log(1-i_16*lambda/M))))))
	f=g(1)+chi*g(2)-0.5q0*(-1)**N*(I1+chi*I2)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~		
	end function zeta_30
!#######################################################################
	function ln_gamma(z) result(f)
! ln_gamma  Computes the logarithm of the Gamma function in the entire complex plane
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 	
	implicit none
	complex(kind=16), intent(in)	:: z
	complex(kind=16)		:: f, w
	integer				:: k
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  real(kind=16), parameter	:: pi_16=3.141592653589793238462643383279502884q0
  complex(kind=16), parameter	:: i_16=(0.0q0,1.0q0) 
  complex(kind=16), parameter	:: c(1:10)=&  
  (/(-6.32899264378083954638419690213358305q-19,-5.02618515225831864524291125577114754q-19),&
    (9.00118789519049878055317954964612560q-16,1.18043955890013107152066865403796443q-15),&
    (-4.29204799869012678130788469868436316q-14,-4.66621190267878627507686221512522336q-13),&
    (-3.06993266002176329741933845106314762q-11,4.58256502470738272942404661111310553q-11),&
    (3.20896062831335555334601331074941425q-9,-8.45570160599064823800107884664011153q-10),&
    (-1.09470182714659777673083157232597235q-7,-5.24436125117097128364528129393000065q-8),&
    (1.47528847671109786357817665562717741q-6,-2.65586627509694548648297660078199290q-6),&
    (-5.50768797120583008282927935725546637q-6,5.81608431331109985941637330149412975q-5),&
    (4.31122232694993407331819857083550188q-4,1.11921275658933787495833864997198982q-3),&
    (-2.41037222250212947178816411812599360q-9,-4.21699693059619209244770449485032864q-9)/)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
   real(kind=16), parameter 	:: c_r(1:10)=&  
   (/-2.00169371367851077240921611133845440q-3,&   
     1.43128980975431349878973832819745521q-3,&  
     8.69393952658216645174904902551239677q-4,&   
     -5.41543864782889254528473496920294957q-4,&  
     -6.98972526780601311534472208134570921q-4,&   
     -6.02535738432353374274741775542021765q-4,& 
     -4.02426638590669366133087883380795036q-4,&
     -2.08082060765028076175427617315967047q-4,&   
     -7.51589218439833233388701348386165060q-5,&   
     -1.31214481570680189526382098899024992q-5/)   
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   complex(kind=16), parameter	:: lambda(1:10)=&  
   (/(6.15772691848436302117950334290956840q0,5.82678927522618136678128661545234970q0),& 
     (5.70615059581813427304565174124639501q0,4.57767378167759699020117820108089056q0),& 
     (5.30370779721225742665966313861552107q0,3.63037687497795980682021854514944400q0),& 
     (4.92088169519527369357869627612543856q0,2.84880842625788893914763257537801717q0),& 
     (4.54514250023857218026370650640521016q0,2.17931076980339710121742097822727628q0),& 
     (4.16751786754127005568543614893858217q0,1.59323074506298371504158985275637993q0),& 
     (3.77782853497654937912120172342150212q0,-1.07224418246785135369876203150328604q0),& 
     (3.35848914848803730410049013333407534q0,-6.01249735439710145730606107292408783q-1),& 
     (2.85117399421515274972075545340518913q0,1.58182551673758068922716182867928173q-1),& 
     (2.11951140814251496765423382357130447q0,-6.91198414476815744877210668869951012q-1)/)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    
   real(kind=16), parameter	:: lambda_r(1:10)=&  
   (/2.21771976816897749191699587269624580q0,& 
    1.81418432423509982786230354779162763q0,& 
    1.64516199407584064978689467741899988q0,& 
    1.37707044937426736953581755343856311q0,& 
    1.27428377575649369564587907893861732q0,& 
    1.18984188810634545941949504290129028q0,& 
    1.12226750115995944208083314090584000q0,& 
    1.07035206271462406505484513395398115q0,& 
    1.03311805263012155459126730383420396q0,& 
    1.00981307264980725643979710105875975q0/)
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	if (z%re>1.5q0) then
		f=sum(c/(z-1+lambda)**3+conjg(c)/(z-1+conjg(lambda))**3+c_r/(z-1+lambda_r)**3)  
		f=2*f+(z-0.5q0)*log(z)-z+1/(12*z)+0.5q0*log(2*pi_16)
	elseif (z%re>0.5q0) then ! use the functional equation log(Gamma(z))=log(Gamma(z+1))-log(z)	
		f=sum(c/(z+lambda)**3+conjg(c)/(z+conjg(lambda))**3+c_r/(z+lambda_r)**3)  
		w=z+1;
		f=(2*f+(w-0.5q0)*log(w)-w+1/(12*w)+0.5q0*log(2*pi_16))-log(z)
	elseif (z%im>=0.0q0) then ! use reflection formula
		w=2-z
		f=sum(c/(w-1+lambda)**3+conjg(c)/(w-1+conjg(lambda))**3+c_r/(w-1+lambda_r)**3)	
		f=log(1-z)-(2*f+(w-0.5q0)*log(w)-w+1/(12*w))+0.5q0*log(2*pi_16)+pi_16*i_16*(z-0.5q0)-log(1-exp(2*pi_16*i_16*z))
	else 	 ! use reflection formula
		w=2-z
		f=sum(c/(w-1+lambda)**3+conjg(c)/(w-1+conjg(lambda))**3+c_r/(w-1+lambda_r)**3)	
		f=log(1-z)-(2*f+(w-0.5q0)*log(w)-w+1/(12*w))+0.5q0*log(2*pi_16)-pi_16*i_16*(z-0.5q0)-log(1-exp(-2*pi_16*i_16*z))	
	end if
!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	end function ln_gamma
